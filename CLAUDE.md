# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Personal study repository for fast.ai "Practical Deep Learning for Coders" Course Part 2: "From Deep Learning Foundations to Stable Diffusion." The course progressively builds **miniai**, a minimal deep learning library, from scratch in Jupyter notebooks.

## Development Environment

**IMPORTANT**: Always use the virtual environment located at `~/venv` for all Python operations in this workspace:
- Python commands: `~/venv/bin/python`
- Pip commands: `~/venv/bin/pip`

This ensures correct dependencies and environment isolation for the fast.ai course work.

## Repository Structure

- **fastbook/**: Course textbook (reference, gitignored)
- **course22p2/**: Lecture notebooks and miniai library source (reference, gitignored)
  - **nbs/**: Numbered lecture notebooks (01_matmul through 28_diffusion)
  - **miniai/**: Python library auto-generated from notebooks via nbdev
- **lesson-xx/**: Per-lesson working directories containing:
  - Lecture notebooks copied from course22p2/nbs/ for hands-on study
  - Practice and note notebooks (e.g. `mynote.ipynb`) created during learning

## Key Commands

```bash
# Install miniai in dev mode (from course22p2/)
pip install -e course22p2/

# Rebuild miniai .py files from notebooks (from course22p2/)
nbdev_export
```

## Architecture: miniai Library

The miniai library uses a **callback-based training loop** pattern:

- `learner.py`: Core `Learner` class with callback hooks (before_fit, after_batch, etc.)
- `training.py`: Basic training utilities, Dataset class, `fit()` function
- `conv.py`: Convolution utilities and device management (`def_device`, `to_device()`)
- `diffusion.py` / `diffusion2.py`: Diffusion model implementations (DDPM, DDIM)

All `.py` files in miniai are **autogenerated by nbdev** from the corresponding notebooks â€” edit the notebooks, not the .py files.

## Conventions

- **Notebook naming**: Numbered sequentially (`01_matmul.ipynb`, `02_meanshift.ipynb`)
- **Device handling**: Uses `def_device` which auto-selects mps > cuda > cpu
- **fastcore utilities**: Heavy use of `store_attr`, `patch` decorator, `delegates`, and `L` (enhanced list)
- **Dependencies**: torch, fastcore, fastprogress, matplotlib, datasets, diffusers, einops, timm
