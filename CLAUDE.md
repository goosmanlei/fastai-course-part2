# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Personal study repository for fast.ai 2022-23 Course Part 2: "From Deep Learning Foundations to Stable Diffusion." The course progressively builds **miniai**, a minimal deep learning library, from scratch in Jupyter notebooks.

## Repository Structure

- **lesson-09/ through lesson-25/**: Personal study notebooks for each lesson
- **course22p2/**: Official course materials including the miniai library (gitignored, reference only)
  - **course22p2/nbs/**: Numbered source notebooks (01_matmul through 28_diffusion)
  - **course22p2/miniai/**: Python library auto-generated from notebooks via nbdev
- **fastbook/**: Fast.ai textbook (gitignored, reference only)

## Key Commands

```bash
# Install miniai in dev mode (from course22p2/)
pip install -e course22p2/

# Rebuild miniai .py files from notebooks (from course22p2/)
nbdev_export
```

## Architecture: miniai Library

The miniai library uses a **callback-based training loop** pattern:

- `learner.py`: Core `Learner` class with callback hooks (before_fit, after_batch, etc.)
- `training.py`: Basic training utilities, Dataset class, `fit()` function
- `conv.py`: Convolution utilities and device management (`def_device`, `to_device()`)
- `diffusion.py` / `diffusion2.py`: Diffusion model implementations (DDPM, DDIM)

All `.py` files in miniai are **autogenerated by nbdev** from the corresponding notebooks â€” edit the notebooks, not the .py files.

## Conventions

- **Notebook naming**: Numbered sequentially (`01_matmul.ipynb`, `02_meanshift.ipynb`)
- **Device handling**: Uses `def_device` which auto-selects mps > cuda > cpu
- **fastcore utilities**: Heavy use of `store_attr`, `patch` decorator, `delegates`, and `L` (enhanced list)
- **Dependencies**: torch, fastcore, fastprogress, matplotlib, datasets, diffusers, einops, timm
